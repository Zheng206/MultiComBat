% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/covbat.R
\name{covbat}
\alias{covbat}
\title{CovBat-style harmonization of a single block via PCA scores}
\usage{
covbat(
  R,
  site,
  center = TRUE,
  scale_scores = TRUE,
  var_thresh = 0.95,
  min_rblock = 1,
  max_rblock = Inf,
  ref.batch = NULL
)
}
\arguments{
\item{R}{Numeric matrix/data frame \eqn{n \times p} (rows = subjects).}

\item{site}{Factor (or coercible) of length \eqn{n} with site/batch labels.}

\item{center}{Logical; pass to \code{\link[stats:prcomp]{stats::prcomp()}} (default \code{TRUE}).}

\item{scale_scores}{Logical; if \code{TRUE}, scale variables before PCA score
harmonization (passed as \code{scale.} to \code{\link[stats:prcomp]{stats::prcomp()}}) (default \code{TRUE}).}

\item{var_thresh, min_rblock, max_rblock}{See \code{\link[=pick_r_from_pc]{pick_r_from_pc()}}; determine
how many PC scores are harmonized.}

\item{ref.batch}{Optional reference batch for \code{\link[=com_harm]{com_harm()}} (univariate).}
}
\value{
\eqn{n \times p} numeric matrix: harmonized data on the original scale.
}
\description{
Implements a simple CovBat pipeline for one block:
\enumerate{
\item PCA on \code{R}, keep \code{r} PCs so that cumulative variance \eqn{\ge} \code{var_thresh}.
\item Harmonize the first \code{r} PC scores across \code{site} with \code{\link[=com_harm]{com_harm()}} (univariate EB off).
\item Reconstruct the data using harmonized first \code{r} scores and original
remaining scores, then invert the PCA transform.
}
}
\examples{
set.seed(4)
n <- 40; p <- 30
R <- scale(matrix(rnorm(n*p), n, p))
site <- factor(rep(LETTERS[1:2], each = n/2))
R_h <- covbat(R, site, var_thresh = 0.9, min_rblock = 2)
dim(R_h)

}
\seealso{
\code{\link[=pick_r_from_pc]{pick_r_from_pc()}}, \code{\link[=com_harm]{com_harm()}}, \code{\link[stats:prcomp]{stats::prcomp()}}
}
