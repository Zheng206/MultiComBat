% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/eb_method.R
\name{eb_algorithm}
\alias{eb_algorithm}
\alias{eb_algorithm.univariate}
\alias{eb_algorithm.multivariate}
\title{Empirical Bayes shrinkage for ComBat parameters}
\usage{
eb_algorithm(type, ...)

\method{eb_algorithm}{univariate}(
  type,
  data_stand_result,
  batch_result,
  eb = TRUE,
  robust.LS = FALSE,
  ...
)

\method{eb_algorithm}{multivariate}(
  type,
  data_stand_result,
  batch_result,
  eb = TRUE,
  robust.LS = FALSE,
  ...
)
}
\arguments{
\item{type}{An object created by \code{\link{combat_type}} or a character
scalar equal to its class (\code{"univariate"} or \code{"multivariate"}).}

\item{...}{Passed to methods.}

\item{data_stand_result}{For the multivariate method, a \emph{list} of length
\eqn{m} (measurements/modalities). Each element is the output of
\code{standardize_data()} for that measurement.}

\item{batch_result}{For the multivariate method, a \emph{list} of length
\eqn{m}, each element the output of \code{batch_matrix()} for that
measurement. All must share the same batch levels.}

\item{eb}{Logical; if \code{TRUE} (default) perform EB shrinkage. If
\code{FALSE}, return method-of-moments estimates without shrinkage.}

\item{robust.LS}{Logical; when \code{TRUE}, use robust variance estimates in
\code{\link{delta_hat_gen}} via \code{\link{biweight_midvar}}.}
}
\value{
See method-specific return values below.

For the univariate method, a list with:
\describe{
\item{\code{gamma_star}}{Batch-by-feature matrix of shrunken means.}
\item{\code{delta_star}}{Batch-by-feature matrix of shrunken variances.}
\item{\code{gamma_hat}}{Batch-by-feature sample means before EB.}
\item{\code{delta_hat}}{Batch-by-feature sample/robust variances before EB.}
\item{\code{mom}}{List of hyperparameters (\code{g_bar}, \code{g_var},
\code{d_bar}, \code{d_var}, \code{d_a}, \code{d_b}) per batch.}
}

For the multivariate method, a list with:
\describe{
\item{\code{gamma_star}}{Named list over batches; each element is an
\eqn{m \times G} matrix of shrunken means across measurements (rows)
for each feature \eqn{g=1,\dots,G} (columns).}
\item{\code{delta_star}}{Named list over batches; each element is a
length-\eqn{G} list of \eqn{m \times m} covariance matrices (one per feature).}
\item{\code{gamma_hat}, \code{delta_hat}, \code{mom}}{Pre-EB estimates and
EB hyperparameters per batch (see Details of \code{\link{mom_calculation}}).}
}
}
\description{
S3 generic for running the empirical Bayes (EB) step that shrinks per-batch
location (\eqn{\gamma}) and scale/covariance (\eqn{\delta}) parameters toward
pooled priors, either feature-wise (univariate) or measurement-wise
(multivariate).
}
\details{
The multivariate EB step updates, for each feature \eqn{g}, the mean vector
\eqn{\gamma_{\cdot g}} and covariance \eqn{\Delta_g} across measurements via
normalâ€“inverse-Wishart-like shrinkage with hyperparameters estimated by
method of moments.
}
\examples{
\dontrun{
type <- combat_type("univariate")
# eb_algorithm(type, data_stand_result, batch_result)
}

}
