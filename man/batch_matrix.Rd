% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_prep.R
\name{batch_matrix}
\alias{batch_matrix}
\title{Build batch design matrix and index helpers}
\usage{
batch_matrix(bat, ref.batch = NULL)
}
\arguments{
\item{bat}{A \strong{factor} vector of batch labels. Unused levels are dropped.}

\item{ref.batch}{Optional length-1 character or factor level naming the
reference batch. Must be one of \code{levels(bat)}; otherwise an error is thrown.}
}
\value{
A list with components:
\describe{
\item{batch_vector}{The (dropped-levels) batch factor.}
\item{batch_matrix}{An \eqn{n \times B} model matrix of batch dummies
with no intercept (\code{model.matrix(~ -1 + bat)}).}
\item{batch_index}{A named list of integer indices for each batch level.}
\item{n_batches}{A named integer vector: counts per batch level.}
\item{ref}{A logical vector of length \eqn{n} marking the reference batch,
or \code{NULL} if \code{ref.batch} is not supplied.}
}
}
\description{
Constructs a one-hot batch design matrix, per-batch indices, counts, and an
optional logical indicator for a reference batch.
}
\examples{
set.seed(1)
bat <- factor(sample(c("siteA", "siteB", "siteC"), 10, replace = TRUE))

# With a reference batch
out <- batch_matrix(bat, ref.batch = "siteA")
names(out)
head(out$batch_matrix)
out$n_batches
table(out$ref)

# Without a reference batch
out2 <- batch_matrix(bat)
str(out2$batch_index)

}
