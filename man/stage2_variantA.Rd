% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/covbat.R
\name{stage2_variantA}
\alias{stage2_variantA}
\title{Stage-2 variant A: harmonize shared scores, then reconstruct blocks}
\usage{
stage2_variantA(
  R_list,
  site,
  center = TRUE,
  scale_scores = TRUE,
  var_thresh = 0.8,
  min_rblock = 1,
  max_rblock = Inf
)
}
\arguments{
\item{R_list}{List of \eqn{m} blocks (\eqn{n \times p_t} each), same rows/subjects.}

\item{site}{List of \eqn{m} site/batch factors (one per block). Only the
first element is used for harmonizing \code{G} in this variant.}

\item{center, scale_scores, var_thresh, min_rblock, max_rblock}{Passed to \code{\link[=score_space_coupling]{score_space_coupling()}} (see its documentation).}
}
\value{
A list with:
\describe{
\item{R_h_list}{List of harmonized blocks (same shapes as inputs).}
\item{coupling}{The object returned by \code{\link[=score_space_coupling]{score_space_coupling()}}.}
\item{G_star}{Harmonized shared scores \eqn{G^\*}.}
\item{meta}{List with \code{r_shared}, \code{center}, \code{scale_scores}.}
}
}
\description{
A two-stage pipeline for multiple blocks:
\enumerate{
\item Couple blocks in score space via \code{\link[=score_space_coupling]{score_space_coupling()}} to obtain
shared subject scores \eqn{G}.
\item Harmonize \eqn{G} across sites with \code{\link[=com_harm]{com_harm()}} (univariate),
yielding \eqn{G^\*}.
\item Reconstruct each block using \eqn{G^\*}, the block projection
\eqn{A_t}, residual scores \eqn{H_t}, and loadings \eqn{L_t}.
}
}
\examples{
\dontrun{
set.seed(3)
n <- 50
R1 <- scale(matrix(rnorm(n*25), n, 25))
R2 <- scale(matrix(rnorm(n*15), n, 15))
site <- list(factor(rep(LETTERS[1:2], each = n/2)),
             factor(rep(LETTERS[1:2], each = n/2)))
out <- stage2_variantA(list(R1, R2), site, var_thresh = 0.9, min_rblock = 2)
lapply(out$R_h_list, dim)
}

}
\seealso{
\code{\link[=score_space_coupling]{score_space_coupling()}}, \code{\link[=reconstruct_block]{reconstruct_block()}}, \code{\link[=com_harm]{com_harm()}}
}
